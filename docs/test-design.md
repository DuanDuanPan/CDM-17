---
title: Test Design — 脑图驱动协同研发平台
date: 2025-12-12
owner: Enjoyjavapan
status: draft
scope: 系统级可测性评估（对应 PRD R1–R24、架构、UX）
---

## 1. 测试范围与目标
- 覆盖脑图/多视图/任务依赖/审批/权限/水印/通知节流/导出/分享/访问记录/模板与快速上手/自由布局等核心能力。
- 聚焦大图性能（1k 节点、50 并发）、安全合规（密级/字段/附件、审计、水印、遮罩）、导出与分享的可靠性。
- 桌面 Web 场景；无移动与离线。

## 2. 场景优先级（P0/P1）
- P0：权限与密级、审批驱动执行、通知节流、导出水印遮罩、分享密级校验、访问记录写入/查询、1k 节点性能基线。
- P1：模板/片段复用、AI 骨架、自由布局对齐/吸附/网格、评论 @mention 未读、导出分片重试。

## 3. 关键测试设计
- 权限与水印
  - 用例：低密级用户访问高密级节点；字段/附件遮罩；下载/预览带水印；分享链接默认水印。
  - 断言：访问被拒或遮罩；水印包含用户/时间/IP；审计记录正确。
- 审批驱动执行
  - 用例：审批通过后自动推演下一任务；审批驳回不推演；并行依赖（SS）不阻塞。
  - 断言：后继任务状态更新；通知触发且节流规则生效。
- 通知节流
  - 用例：同节点同事件 1 分钟内多次触发；高优事件（阻塞/驳回）实时。
  - 断言：汇总条数、时间窗符合 5 分钟去重/汇总；高优即时送达。
- 导出/分享/遮罩
  - 用例：全图/子树导出 PDF/ZIP；遮罩强制开启；遮罩节点>500 触发降级提示（结构-only 或子树）；导出分片重试；分享创建默认有效期 7 天（1–30 调整）；资源密级≥机密禁止公开链接；链接失效后访问。
  - 断言：导出 P95<3s（中等规模）；遮罩字段不可见并记录遮罩计数；降级提示出现且可完成导出；超密级链接被阻断（40301/41001）；失效立即生效并写访问记录。
- 访问记录
  - 用例：查看/编辑/下载/分享访问后查询；按时间/密级过滤；导出 CSV/JSON；跨热/冷存储时间窗查询；IP/UA 30 天后哈希化校验；查询必须带 project_id+时间窗。
  - 断言：记录完整，P95 查询<2s；导出成功；返回字段符合 schema；敏感字段按 30 天哈希规则处理。
- 大图性能与协同
  - 用例：1k 节点加载、缩放、折叠、批量粘贴；50 并发编辑；多人光标/评论冲突提示。
  - 断言：P95 交互<100ms、协同<200ms；冲突提示可见；未丢事件。
- 自由布局与模板
  - 用例：自由模式对齐/吸附/网格开关；模板插入预置字段/密级；保存子树为片段复用。
  - 断言：对齐线显示正确；插入校验权限；片段复用保持字段/密级。

## 4. 度量与验收阈值
- 性能：P95 交互<100ms；协同<200ms；导出中等规模<3s；访问记录查询<2s；通知节流命中率>90%。
- 可靠性：导出成功率>99%；审计/访问记录写入成功率>99.9%；分享失效传播<1s。
- 安全：遮罩零泄露；水印默认开启且不可关闭；超密级分享被阻断率100%；错误码与文案一致（40301/40302/40303/41001/42910）。

## 5. 工具与方法
- 前端：Playwright/基准脚本（性能+可用性）；埋点收集 P95/P99。
|- 后端：接口级单元+契约测试；k6/Locust 压测 Script-P1/P2/P3（1k 节点、50 并发、导出+访问记录）；审计/导出可靠性用重放队列。
|- 数据：构造 1k 节点基线数据集（含关系线、附件元数据、密级多档）。

## 6. 覆盖矩阵（摘录）
- 功能 vs 需求：R1–R24 → 对应场景上方已映射（详见后续补充矩阵）。
- 平台：桌面 Web。
- 负载：常规 + 压测（1k/50 并发）。

## 7. 未决
- 字段/附件继承策略对测试用例的影响（待架构细化）。
- 跨图血缘可视化的冲突处理测试场景（待后续迭代）。
- 生产级压测环境可用性与数据刷新策略。
